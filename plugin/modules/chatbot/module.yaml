name: chatbot
title: AI chat sidebar and REST API
requires: [document, config, events, ai, http_routes]

actions:
  extend_selection:
    title: "Extend Selection"
  edit_selection:
    title: "Edit Selection"

menus:
  - action: extend_selection
    context: [writer, calc]
  - action: edit_selection
    context: [writer, calc]

shortcuts:
  extend_selection:
    key: Q_MOD1
    context: [writer, calc]
  edit_selection:
    key: E_MOD1
    context: [writer, calc]

config:
  max_tool_rounds:
    type: int
    default: 15
    min: 1
    max: 50
    widget: number
    label: Max Tool Rounds

  context_strategy:
    type: string
    default: "auto"
    widget: select
    label: Document Context Strategy
    helper: "How much document content to include in LLM context"
    options:
      - value: auto
        label: Auto (by document size)
      - value: full
        label: Full document text
      - value: page
        label: Pages around cursor
      - value: tree
        label: Outline + excerpt
      - value: stats
        label: Stats + outline only

  system_prompt:
    type: string
    default: ""
    widget: textarea
    label: System Prompt

  image_provider:
    type: string
    default: endpoint
    widget: select
    label: Image Provider
    options:
      - value: endpoint
        label: LLM Endpoint
      - value: ai_horde
        label: AI Horde (free)

  extend_selection_max_tokens:
    type: int
    default: 70
    min: 10
    max: 4096
    widget: number
    label: Extend Selection Max Tokens

  edit_selection_max_new_tokens:
    type: int
    default: 0
    min: 0
    max: 4096
    widget: number
    label: Edit Selection Extra Tokens
    helper: "Extra tokens beyond original text length. 0 = same length as original."

  tool_broker:
    type: boolean
    default: true
    widget: checkbox
    label: Tool Broker
    helper: "Two-tier tool delivery: LLM gets core tools first, activates others by intent"

  input_position:
    type: string
    default: "bottom"
    widget: select
    label: Input Position
    helper: "Where the query input is placed in the chat panel"
    options:
      - value: bottom
        label: Bottom (ChatGPT style)
      - value: top
        label: Top (terminal style)

  enter_sends:
    type: boolean
    default: true
    widget: checkbox
    label: Enter Sends Message
    helper: "Press Enter to send, Shift+Enter for newline"

  show_mcp_activity:
    type: boolean
    default: true
    widget: checkbox
    label: Show MCP Activity
    public: true

  api_enabled:
    type: boolean
    default: false
    widget: checkbox
    label: Enable Chat API
    helper: "Expose /api/chat endpoints on the HTTP server"
    public: true

  api_auth_token:
    type: string
    default: ""
    widget: text
    label: API Auth Token
    helper: "Optional Bearer token for researchers/external apps. Empty = no auth."

  query_history:
    type: string
    default: "[]"
    internal: true
